## 머신러닝의 규칙
- 머신러닝 관련 권장사항을 참고할 수 있도록 돕는 자료

## 용어
- 아래와 같은 용어가 반복적으로 사용됨 
  - 인스턴스:예측하려는 대상물을 의미/예를 들어 웹페이지를 '고양이와 관련됨' 혹은 '고양이와 무관함'으로 분류하는 경우 이 웹페이지가 인스턴스가 될 수 있음 
  - 라벨:예측 작업에 관한 답으로서, 머신러닝 시스템이 도출하거나 학습 데이터에서 제공된 정답임/예를 들어 웹페이지에 관한 라벨은 '고양이와 관련됨'일 수 있음 
  - 특성:예측 작업에 사용되는 인스턴스의 속성임/예를 들어 웹페이지는 '고양이라는 단어를 포함'한다는 특성을 가짐
  - 특성 열:서로 관련된 특성의 집합임/예를 들어, 사용자가 거주할 수 있는 모든 국가의 집합이 있음
    - 하나의 예는 특성 열에 하나 이상의 특성을 가질 수 있음/다른 시스템에서는 네임스페이스라고도 하고 필드라고도 지칭하는 경우가 있음
  - 예시:인스턴스(특성 포함)및 라벨을 함께 지칭함
  - 모델:예측 작업의 통계적 표현임/예시를 사용하여 모델을 학습한 후 그 모델을 사용하여 예측함
  - 측정항목:내가 관심이 있는 수치임/직접 최적화될 수도 있고, 그렇지 않을 수도 있음
  - 목표:알고리즘에서 최적화하려는 측정항목임
  - 파이프라인:머신러닝 알고리즘의 기반을 이루는 인프라/프런트 엔드에서 데이터를 수집하고, 데이터를 학습 데이터 파일에 넣어, 하나 이상의 모델을 학습함, 모델은 프로덕션 환경으로 내보내는 과정이 포함됨 
  - 클릭률:웹페이지 방문자가 광고의 링크를 클릭하는 비율임

## 개요
- 기본적인 접근법
  - 1.파이프라인에 처음부터 끝까지 빈틈이 없는지 확인함
  - 2.합리적인 목표부터 시작함
  - 3.상식선에서 단순한 방식으로 특성을 추가함
  - 4.파이프라인에 빈틈이 없는지 확인함
- 단순한 방식으로 더 이상 진전을 기대할 수 없는 경우에만 이외에 다른 접근법을 모색해야함/복잡성이 더해지면 개발이 느려짐
- 단순한 방식으로 부족하다면 지금부터 배울 머신러닝 기법에 도전해야함/3단계 머신러닝 프로젝트
  - 1부에서는 머신러닝 시스템을 구축하기에 적절한 시점을 판단하는데 도움을 줌
  - 2부에서는 첫 번째 파이프라인을 구축하는 방법을 설명함
  - 3부에서는 파이프라인에 새 특성을 추가해가며 출시와 반복을 거듭하고, 모델 및 학습-서빙 격차를 평가하는 방법을 설명함
  - 4부에서는 개선이 한계에 부딪치면 무엇을 해야 하는지 설명함
  
## 시작전
- 규칙 #1:머신러닝 없이 제품을 출시하는 것을 두려워하지 말라.
  - 머신러닝은 우선 데이터가 필요함/다른 문제로부터 데이터를 가져와서 모델을 약간 수정하여 새 제품에 적용하는 방법은 이론적으로는 가능하지만 기초적인 휴리스틱보다도 성능이 떨어질 수도 있음
  - 머신러닝이 제품에 절대적으로 필요한 기능이 아니라면 데이터를 충분히 수집하기 전까지는 사용하지 마라
- 규칙 #2:가장 먼저 측정항목을 설계하고 구현하라.
  - 머신러닝의 기능과 역할을 공식화하기 전에 현재 시스템의 상황을 최대한 자세히 추적해야 함
    - 1.시스템 사용자로부터 미리 사용 권한을 받는 것이 여러모로 수월함
    - 2.향후 발생할 것으로 예상하는 문제점이 있다면 지금부터 이전 데이터를 수집해 두는 편이 좋음
    - 3.측정항목 계측을 염두에 두고 시스템을 설계한다면 나중에 작업이 편해짐/측정항목을 계측하기 위해 로그에서 문자열을 일일이 grep으로 추출할 필요가 없어짐 
    - 4.무엇이 변하고 무엇이 그대로인지 알게 됨
  - 측정항목을 적극적으로 수집할수록 시스템을 전반적으로 파악하기가 쉬워짐 
- 규칙 #3:휴리스틱이 복잡하다면 머신러닝을 선택하라.
  - 휴리스틱이 복잡하면 유지보수가 불가능함/데이터가 확보되었고 달성하려는 목표가 가시화되었다면 머신러닝으로 이행할 수 있음
  - 접근 방식에 대해 끊임없는 업데이트가 필요함/머신러닝 모델이 업데이트 및 유지보수가 더 쉬움

## ML 1단계:첫 번째 파이프라인
- 시스템 인프라를 갖추는 데 집중하여라/파이프라인을 신뢰할 수 있어야 현상을 제대로 파악할 수 있음
- 규칙 #4:최초 모델은 단순하게 유지하고 인프라를 제대로 갖춰라.
  - 첫 번째 모델은 제품 개선에 가장 크게 기여하게 되므로 처음부터 화려한 기능을 갖출 필요는 없음
  - 머신러닝 시스템을 제공하기 전에 다음과 같은 사항을 결정해야함
    - 학습 알고리즘에 예시를 제공할 방법
    - 시스템의 '양호함'과 '불량함'을 판단할 최초 기준
    - 모델을 애플리케이션에 통합할 방법
      - 모델을 실시간으로 적용할 수도 있고, 오프라인에서 예시를 가지고 모델을 미리 연산하여 결과를 테이블에 저장할 수도 있음
      - 예를 들어 웹페이지는 미리 분류하여 테이블에 결과를 저장하는 한편, 채팅 메시지는 실시간으로 분류할 수 있음
  - 단순한 특성 선택 시 다음과 같은 과제를 달성하기가 쉬워짐
    - 특성이 학습 알고리즘에 정확히 도달함
    - 모델이 합리적인 가중치를 학습함
    - 특성이 서버의 모델에 정확히 도달함
      - 위와 같은 3가지 과제를 달성했다면 준비는 끝/이 단순한 모델에서 기준 측정항목과 기준 동작을 얻어 더 복잡한 모델을 테스트하는 데 사용할 수 있음
- 규칙 #5:머신러닝과 별도로 인프라를 테스트하라.
  - 인프라는 테스트할 수 있어야 하며, 시스템의 학습 부분을 캡슐화해야 모든 관련 부분을 테스트할 수 있음
    - 1.알고리즘에 데이터를 넣는 기능을 테스트함/채워져야 하는 특성 열이 채워지는지 확인함/개인정보를 보호하는 범위 내에서 학습 알고리즘의 입력값을 직접 조사함/가능한 경우 파이프라인의 통계를 다른 곳에서 데이터를 처리해 나온 통계와 서로 비교함
    - 2.모델을 학습 알고리즘에서 꺼내는 기능을 테스트함/학습 환경의 모델이 주는 점수가 서빙 환경의 모델과 동일한지 확인함
  - 머신러닝에는 예측 불가능성이 있으므로 학습 및 서빙 시 예시를 생성하는 코드를 테스트할 준비를 하고, 서빙 중에 고정 모델을 로드하여 사용할 수 있을지 확인함/데이터를 이해하는 것이 중요함 
- 규칙 #6:파이프라인을 복사할 때는 데이터 누락에 주의하라.
  - 기존 파이프라인을 복사하여 파이프라인을 만들었는데, 새 파이프라인에 필요한 데이터가 이전 파이프라인에서 누락되는 경우가 종종 있음
  - 사용자가 조회한 데이터만 기록하는 패턴이 있기도 함 
- 규칙 #7:휴리스틱을 특성으로 변환하거나 외부에서 처리하라.
  - 머신러닝으로 해결하려는 문제들은 일반적으로 새로 등장한 문제는 아님/어떠한 문제든 이를 해결하는 기존 시스템이 있음
  - 수많은 규칙과 휴리스틱이 이미 존재하고 있음/이러한 휴리스틱을 머신러닝과 조합하면 돌파구를 마련할 수 있음 
  - 기존 휴리스틱을 철저히 분석해야 하는 두 가지 이유는 다음과 같음
    - 1.머신러닝 시스템으로 더욱 매끄럽게 전환할 수 있음
    - 2.이러한 규칙은 시스템에 대해 버리기 아까운 직관을 풍부하게 담고 있음
  - 네 가지 방법으로 기존 휴리스틱을 활용할 수 있음
    - 1.휴리스틱을 사용하여 전처리함/품질이 뛰어난 특성인 경우에는 고려해볼 만함/이진 분류 작업시
    - 2.특성을 만듬/휴리스틱에서 직접 특성을 만들면 좋음/예를 들어 휴리스틱을 사용하여 쿼리 결과의 관련성 점수를 계산하는 경우 이 점수를 특성값으로 포함할 수 있음/이후에 값을 불연속 값의 유한집합 중 하나로 변환하거나 값을 다른 특성과 합하는 등의 머신러닝 기법을 사용하여 값을 조정할 수 있지만 처음에는 휴리스틱으로 산출되는 값을 그대로 사용해도 됨 
    - 3.휴리스틱의 원시 입력값을 마이닝함/앱에 대해 설치 횟수,텍스트 문자 수,요일을 결합하는 휴리스틱이 있다면 이러한 값을 따로따로 가져와서 학습에 별도로 제공하는 것이 좋음 
    - 4.라벨을 수정함/휴리스틱이 현재 라벨에 포함되지 않는 정보를 포착한다고 생각될 때 이 방법을 사용할 수 있음
  - ML시스템에서 휴리스틱을 사용하는 경우 복잡성이 더해진다는 점에 유의하여라/새로운 머신러닝 알고리즘에 기존 휴리스틱을 사용하면 전환 과정이 원할해질 수 있지만, 더 간단한 방법으로 같은 효과를 낼 수는 없을지 고민해야함
 
## 모니터링
- 일반적인 권장사항은 알림을 깔끔하게 유지하는 것임/알림에 실질적인 정보를 기재하고 대시보드 페이지를 준비해야함
- 규칙 #8:시스템의 갱신 요구사항을 파악하라.
  - 모델이 시간이 지남에 따라 성능이 얼마나 떨어지는지 파악해봐라/이 정보는 모니터링의 우선순위를 판단하는 데 도움이 됨 
  - 하루 동안 모델을 업데이트하지 않으면 제품의 품질이 심각하게 저하되는 경우 모델을 지속적으로 모니터링 해야함
- 규칙 #9:모델을 내보내기 전에 문제를 탐지하라.
  - 모델을 서빙 환경으로 내보내는 단계가 있는데, 내보낸 모델에 문제가 있는 경우 사용자가 곧바로 알아차리게 됨 
  - 모델을 내보내기 전에 상태 확인을 수행하여라/홀드아웃 데이터에 관한 모델의 성능이 적절한지 확인해야 함
  - 데이터의 신빙성이 의심되는 경우 모델을 내보내지 말아라/계속해서 내보낼 경우 대부분 AUC(ROC곡선 아래 영역)를 확인한 후에 내보냄
  - 모델을 제때 내보내지 못하는 이슈는 이메일 알림으로 해결 할 수 있지만, 문제가 있는 모델을 사용자에게 제공하면 사태가 커짐/늦더라도 최대한 만전을 기하는 것이 좋음
- 규칙 #10:조용한 실패에 주의하라.
  - 조인 대상이 되는 특정 테이블이 더 이상 업데이트되지 않는다고 가정해 봄/이 테이블에 따라 머신러닝 시스템을 조정하면 겉보기에는 특별한 문제가 없더라도 실제로는 성능이 점점 떨어짐
  - 몇 달 동안 그대로였던 테이블을 찾아내서 갱신하는 것만으로도 놀라운 성능 개선 효과를 거둘 수 있음 
  - 구현 변경으로 인해 특성의 포함 범위가 바뀌기도 함
  - 예를 들어 특성 열이 입력된 예시의 비율이 90%에서 60%로 급락할 수 있음/Play의 경우 6개월 동안 그대로였던 테이블을 갱신했더니 설치율이 2%나 상승함 
    - 데이터의 통계를 추적하고 경우에 따라 직접 조사하면 이러한 유형의 실패를 줄일 수 있음 
- 규칙 #11:특성 열에 소유자를 지정하고 문서화하라.
  - 시스템의 규모가 크고 특성 열이 많은 경우 각 특성 열을 누가 만들었고 누가 관리하는지를 알아야함
  - 이름만 봐도 의미를 알 수 있는 특성 열도 많긴 하지만 특성의 의미, 출처, 유용성을 자세히 기록해 두는 습관을 들이는 것이 좋음

## 첫 번째 목표
- 시스템에서 중요하다고 생각하는 측정항목이 아무리 많더라도 머신러닝 알고리즘에 필요한 목표, 알고리즘에서 최적화를 '시도'히는 수치는 일반적으로 단 하나임
- 목표와 측정항목을 잘 구분해야함/측정항목은 시스템에서 보고하는 모든 수치로서 중요할 수도, 그렇지 않을 수도 있음 
- 규칙 #12:어떤 목표를 직접 최적화할지 지나치게 고민하지 말라.
  - 모든 측정항목이 쉽게 증가할 수 있으므로, 다양한 측정항목 간에 균형을 맞추려고 지나치게 고민하지 말고 단순하게 생각하면 됨
  - 이 규칙에는 한도가 있음/목표와 시스템의 궁극적인 건전성을 혼동해서는 안됨
  - 직접 최적화하는 측정항목은 개선되지만 결국 출시에 실패하는 상황이 반복된다면 목표를 수정해야 할 수 있음
- 규칙 #13:단순하고 관찰 가능하며 추적 가능한 측정항목을 첫 번째 목표로 선택하라.
  - ML 목표는 측정하기 쉬우면서도 '진정한'목표를 반영해야함
  - 실제로는 '진정한'목표가 존재하지 않는 경우도 많음/따라서 단순한 ML 목표를 기준으로 학습하되, 또다른 로직(가급적 매우 단순하 로직)을 추가해 최종 순위를 결정할 수 있도록 '정책 레이어'를 상단에 두는 것이 좋음
  - 가장 모델링하기 쉬운 대상은 직접 관찰되고 시스템 동작과의 인과성을 추적할 수 있는 사용자 행동임
    - 순위 결정 대상 링크가 클릭되었는가?
    - 순위 결정 대상 개체가 다운로드되었는가?
    - 순위 결정 대상 개체가 전달되거나, 회신되거나, 이메일로 발송되었는가?
    - 순위 결정 대상 개체가 평가되었는가?
    - 표시 대상 개체가 스팸/음란물/불쾌감을 주는 콘텐츠로 신고되었는가?
  - 간접 효과는 처음에는 모델링하지 마라.
    - 사용자가 다음 날 방문했는가?
    - 사용자가 사이트를 
  
  
