## 프로덕션 ML시스템
- ML모델과 코드는 실제 프로덕션 ML 시스템 생태계의 한 부분에 지나지 않음 
- ML 코드는 실제 ML 프로덕션 시스템의 중심에 있지만 일반적으로 전체 ML 프로덕션 시스템 코드의 5%만을 나타냄
- ML 프로덕션 시스템은 입력 데이터에 많은 리소스를 투입하여 데이터를 수집 및 확인하고 데이터에서 특성을 추출함 
- ML 모델의 예측을 실제로 사용하려면 서빙 인프라를 설치해야함 
<img src="https://user-images.githubusercontent.com/32586985/71470291-feefc100-280e-11ea-9df7-b2502432596c.PNG">

- 모든 구성요소를 직접 만들 필요는 없음 
  - 가능하면 일반 ML 시스템 구성요소를 재사용
  - Google CloudML 솔루션에는 Dataflow 및 TF 서빙이 포함됨
  - Spark, Hadoop 등 다른 플랫폼에서도 구성요소를 찾을 수 있음 
  - 어떤 구성요소가 필요한지 어떻게 알 수 있나?
    - 몇 가지 ML시스템 패러다임과 요구사항 확인 
    

## 정적 학습과 동적 학습 비교
- 정적 모델은 오프라인으로 학습됨/즉, 모델을 한 번만 학습시키고 해당 모델을 일정 기간 사용함
  - 손쉬운 빌드 및 테스트 - batch 학습 및 테스트, 만족스러울 때까지 반복
  - 여전히 입력 모니터링 필요
  - 노후화되기 쉬움 
- 동적 모델은 온라인으로 학습됨/즉, 데이터가 시스템에 계속 유입되며 지속적인 업데이트를 통해 해당 데이터를 모델에 통합함 
  - 지속적으로 학습 데이터 공급, 정기적으로 업데이트된 버전 동기화
  - batch 학습 및 테스트가 아닌 점진적 검증 사용
  - 모니터링, 모델 롤백 및 데이터 격리 기능 필요
  - 변화에 적응 가능, 노후화 문제 방지 
- 데이터 세트가 시간에 따라 변화하지 않는다면, 동적 학습보다 개발 및 유지 비용이 낮은 정적 학습 선택이 나음 
- 하지만 정적 학습을 사용하더라도 여전히 입력 데이터의 변화를 모니터링해야함 


## 정적 추론과 동적 추론 비교
- 오프라인 추론
  - MapReduce 등을 사용하여 가능한 모든 예측을 일괄적으로 생성함 
  - 테이블에 기록한 후 캐시/조회 테이블에 입력함
  - 장점
    - 추론 비용을 크게 신경 쓸 필요가 없음
    - batch quota를 사용할 수 있음 
    - 데이터 예측값을 푸시하기 전에 사후 검증이 가능함
  - 단점
    - 알고 있는 항목만 예측할 수 있으며 길게 늘어지는 분포에 적합하지 않음
    - 업데이트 지연 시간이 몇 시간 내지 며칠이 걸릴 수 있음 
- 온라인 추론
  - 서버를 사용하여 요청 시 예측함
  - 장점
    - 새로 들어오는 항목을 바로 예측할 수 있으며 길게 늘어지는 분포에 적합함
  - 단점
    - 연산 리소스가 많이 소요되고 지연 시간에 민감하여 모델 복잡도가 제한될 수 있음 
    - 모니터링 요구사항이 더 많음 


## 데이터 종속성
- 특성 관리
  - 입력 데이터(특성)가 ML 시스템 행동을 결정함
    - 소프트웨어 라이브러리용 유닛 테스트는 작성하지만 데이터는 어떤가?
  - 입력 신호를 선택할 때는 주의해야함
    - 어떤 소프트웨어 라이브러리에 종속될지 결정할 때보다 더 주의해야 할 수도 있음 

- 입력 데이터에 관해 물어야 할 질문
  - 신뢰성
    - 신호를 사용할 수 없으면 어떻게 되는가?/어떻게 알게 되는가?
    - 예시) 로드가 너무 크면 비정상 종료되는 서버에서 신호가 제공되나?
    - 8월마다 휴가를 떠나는 인력이 신호를 전송하나?
  - 버전 차별화
    - 이 신호를 계산하는 시스템이 변경되기도 하는가?/얼마나 자주 변경되고 무슨 결과가 생기나?
    - 시스템이 변경되면 어떻게 알게 되나?
    - 데이터가 업스트림 과정에서 제공되는 경우도 있음/갑자기 변경될 시 모델이 영향을 받을 수 있음 
    - 업스트림 과정에서 받은 데이터의 사본을 만들어봄/안전하다고 판단될 때만 다음 버전의 업스트림 데이터로 넘어가라
  - 필요성
    - 신호의 유용성이 신호를 포함하는 비용을 정당화하나?
    - 정확성이 더 높은 것이 덜 높은것보다 좋지만 특성을 추가하면 유지관리 부담이 증가함
    - 특성이 추가됨으로써 예기치 않게 성능이 저하될 수 있으므로 모니터링이 필요함 
    - 사소한 단기적 혜택을 제공하는 특성을 추가하기 전에는 신중히 생각해봐라
  - 상관성
    - 내 입력 신호가 아주 긴밀히 연결되어 있어서 분리하기 위한 추가 전략이 필요한가?
    - 일부 특성은 다른 특성과 양의 또는 음의 상관관계를 가짐
    - 특성이 아주 긴밀히 연결되어 있어서 분리하기 위한 추가 전략이 필요한가?
  - 피드백 루프
    - 어떤 입력 신호가 모델의 출력에 영향을 받을 수 있나?
    - 모델이 자체 학습 데이터에 영향을 미칠 수 있는 경우도 있음 
    - 일부 모델에서는 출력 결과값이 직간접적으로 그 모델의 입력 값이 되기도 함
    - 모델이 다른 모델에 영향을 미칠 수 있는 경우도 있음 
    - 예시
      - 모델 A(나쁜 예측 모델)
      - 모델 B
      - 모델 A에 버그가 있으므로 주식 X를 사도록 잘못 결정함/이러한 구매로 인해 주식 X의 주가가 상승함 
      - 모델 B는 주식 X의 주가를 입력 특성으로 사용하므로 모델 B는 주식 X의 가치에 관해 잘못된 결론을 내리기 쉬움
      - 모델 B는 버그가 포함된 모델 A의 행동을 바탕으로 주식 X를 구매하거나 판매함
      - 모델 B의 행동이 다시 모델A에 영향을 미쳐 튤립 파동을 일으키거나 X사의 주식을 떨어뜨릴 수 있음 
    
- ML 시스템의 행동은 ML 시스템 입력 특성의 행동과 특성에 종속됨
- 해당 특성의 입력 데이터가 변경되면 모델도 변경됨
- ML 프로젝트에서는 지속적으로 입력 데이터를 테스트하고 유효성을 확인하고 데이터를 모니터링해야함
- 모델을 지속적으로 모니터링하여 (거의) 사용하지 않는 특성을 삭제해야함
